<!DOCTYPE html>
<html>
<head>
	<title>Wenyang's Django Notes</title>
	<link rel="shortcut icon" href="../public/img/favicon-96x96.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <!--<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>-->
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
	<link href="https://fonts.googleapis.com/css?family=Gentium+Book+Basic" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../public/css/homepage.css">
	<style>
	    .show {
	        display: none;
	    }
	    LI A:hover {
	        cursor: pointer;
	    }
	    LI:before {
            content: "\f0d7"; /* FontAwesome Unicode "\f0d7" for DOWN, "\f0da" for RIGHT  */
            font-family: FontAwesome;
            display: inline-block;
	    }
	    UL {
            list-style: none;
        }
        .change-li-before:before {
            content: "\f0da";
        }
	</style>
</head>
<body>


<h2 class="article-title">
    Django Notes (Django 2.1 & Python 3.7)
</h2>
<figure style="text-align:center">
    <img style="opacity:0.9" src="assets/img/funny-software-engineer-comic.jpg">
    <figcaption>What we try to avoid...</figcaption>
</figure>
<ul class="Aclass">
    <li class="coding-text">
        <a>Introduction</a><br>
        <p><a href="https://www.djangoproject.com/" target="_blank">Django</a> is a <span class="method">Model-View-Controller</span> (MVC) Python framework for web developments. <span class="method2">Click to toggle Show/Hide.</span> Quick install as follows:<br></p>
<pre class="prettyprint lang-bsh ">
pip install django

# check version
django-admin --version  
</pre>    
    </li>
    <li class="coding-text">
	    <a>Building Projects/Apps</a><br>
	    <p>Im this note, the project is created at root <span class="method">~</span></p>
<pre class="prettyprint lang-bsh ">
# 1. create project directory and files at root ~
django-admin startproject mysite

# 2. create app directory and files inside ~/mysite/
python manage.py startapp main
</pre>
        <p>1. Inside <span class="method">~/mysite</span> we have:<span class="method2" style="font-family: 'Monaco', 'Menlo', 'Ubuntu Mono','Consolas','source-code-pro'"> &nbsp; &nbsp; manage.py &nbsp; &nbsp;  mysite</span><br>
        &nbsp; &nbsp; Inside <span class="method">~/mysite/mysite</span> we have: <span class="method2" style="font-family: 'Monaco', 'Menlo', 'Ubuntu Mono','Consolas','source-code-pro'">&nbsp; &nbsp;  __init__.py &nbsp; &nbsp;  settings.py &nbsp; &nbsp;  urls.py &nbsp; &nbsp;  wsgi.py</span><br>
        2. Inside <span class="method">~/mysite/main</span> we have: <span class="method2" style="font-family: 'Monaco', 'Menlo', 'Ubuntu Mono','Consolas','source-code-pro'">&nbsp; &nbsp; admin.py &nbsp; &nbsp; apps.py &nbsp; &nbsp; __init__.py &nbsp; &nbsp; migrations &nbsp; &nbsp; models.py &nbsp; &nbsp; tests.py &nbsp; &nbsp; views.py</span>
        </p>
        
        <p>Here, models.py = Model, views.py = View, urls.py = Controller.        </p>
    </li>
    
    <li class="coding-text">
	    <a>Running Server</a><br>
<pre class="prettyprint lang-bsh ">
# running server at ~/mysite/, default address: "http://localhost:8000/"
python manage.py runserver
</pre>
    </li>
<!----------------------------------- CONTROLLER --------------------------------------->
    
    <li class="coding-text">
	    <a>Controller - <span class="method">urls.py</span></a><br>
<pre class="prettyprint lang-python ">
# ~/mysite/mysite/urls.py    
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('', include('main.urls')),
    path('admin/', admin.site.urls),
    # path('tinymce/', include('tinymce.urls')),
]

# ~/mysite/main/urls.py    
from django.urls import path
from . import views

app_name = "main"

urlpatterns = [
    path('', views.homepage, name='homepage')
]
</pre>	
        
    </li>
 
<!----------------------------------- VIEW --------------------------------------->
    <li class="coding-text">
	    <a>View - <span class="method">views.py</span></a><br>
<p style="font-weight: bold; text-decoration: underline">HttpResponse for testing:</p>
<pre class="prettyprint lang-python ">
# ~/mysite/main/views.py   
from django.shortcuts import render
from django.http import HttpResponse

def homepage(request):
    return HttpResponse("<strong></strong>Hello World!")
</pre>	
<p style="font-weight: bold; text-decoration: underline">Webpage rendering with <a href="http://jinja.pocoo.org/" target="_blank">Jinja</a> Templates: </p>
<pre class="prettyprint lang-python ">
# ~/mysite/main/views.py   
from django.shortcuts import render
from .models import Tutorial

def homepage(request):
    return render(request=request,
                template_name="main/home.html",
                context={"tutorials": Tutorial.objects.all()})
</pre>
    <p><span class="method">Important</span>: Templates will be merged together, so name should be unique, such as <span style="font-family: 'Monaco', 'Menlo', 'Ubuntu Mono','Consolas','source-code-pro'">template_name="main/home.html"...</span></p>
    <p>1. Generic templating: </p>
<pre class="prettyprint lang-html">
&lt;!-- ~/mysite/main/templates/main/home.html   -->
&lt;head>
    {% load static %}
&lt;/head>
&lt;body>
    {% for tut in tutorials %}
        &lt;p>{{tut.tutorial_title}}&lt;/p>
        &lt;p>{{tut.tutorial_published}}&lt;/p>
        &lt;p>{{tut.tutorial_content|safe}}&lt;/p>
    {% endfor %}
&lt;/body>
</pre>   
    <p>2. Template with <span class="method2">Extend</span>: </p>
<pre class="prettyprint lang-html">
&lt;!-- ~/mysite/main/templates/main/header.html   -->
&lt;head>
    {% load static %}
    &lt;!-- load your css, js, ...  -->
&lt;/head>
&lt;body>
    &lt;!-- navbar -->
    
    {% block content %}
    {% endblock %}
    
    &lt;!-- footer -->
&lt;/body>

&lt;!-- ~/mysite/main/templates/main/home.html   -->
{% <strong>extends</strong> "main/header.html" %}

{% block content %}

    {% for tut in tutorials %}
        &lt;p>{{tut.tutorial_title}}&lt;/p>
        &lt;p>{{tut.tutorial_published}}&lt;/p>
        &lt;p>{{tut.tutorial_content|safe}}&lt;/p>
    {% endfor %}
    
{% endblock %}
</pre>  

<p>3. Template (ex. narbar, messages, etc) with <span class="method2">Include</span>: </p>
<pre class="prettyprint lang-html">
&lt;!-- ~/mysite/main/templates/main/header.html   -->
&lt;body>
    ...
    {% include "main/includes/navbar.html" %}
    ...
&lt;/body>

&lt;!-- ~/mysite/main/templates/main/includes/navbar.html   -->
&lt;nav>
    &lt;div class="nav-wrapper">
        &lt;a href="/" class="brand-logo">&emsp;Tutorials&lt;/a>
        &lt;ul id="nav-mobile" class="right hide-on-med-and-down">
            &lt;li>&lt;a href="/">Home&lt;/a>&lt;/li>
        {% if user.is_authenticated %}
            &lt;li>&lt;a href="/account">{{user.username}}&lt;/a>&lt;/li>
            &lt;li>&lt;a href="/logout">Lougout&lt;/a>&lt;/li>
        {% else %}
            &lt;li>&lt;a href="/register">Register&lt;/a>&lt;/li>
            &lt;li>&lt;a href="/login">Login&lt;/a>&lt;/li>
        {% endif %}

        &lt;/ul>
    &lt;/div>
&lt;/nav>
</pre>  
    
    
    
    </li>

<!----------------------------------- MODEL --------------------------------------->

    <li class="coding-text">
	    <a>Model - <span class="method">models.py</span></a><br>
<pre class="prettyprint lang-python ">
# ~/mysite/main/models.py   
from django.db import models
from datetime import datetime
from django.utils.timezone import now

# Create your models here.
class Tutorial(models.Model):
    tutorial_title = models.CharField(max_length=200)
    tutorial_content = models.TextField()
    tutorial_published = models.DateTimeField("date published", default=now())

    def __str__(self):
        return self.tutorial_title
</pre>
<p>Database migrations:</p>
<pre class="prettyprint lang-bsh ">
# ~/mysite/mysite.py   
python manage.py makemigrations
python manage.py migrate
</pre>

<p>How to use local db.sqlite3 database:</p>
<pre class="prettyprint lang-bsh ">
# ~/mysite/mysite.py   
python manage.py shell
>>> from main.models import Tutorial
>>> Tutorial.objects.all()
>>> new_tut = Tutorial(tutorial_title="Hello World", tutorial_content="...")
>>> new_tut.save()
</pre>
<p>See more <a href="https://docs.djangoproject.com/en/2.2/ref/models/fields/" target="_blank">model field reference</a>.</p>
        
    </li>

<!----------------------------------- ADMIN --------------------------------------->
 
    <li class="coding-text">
	    <a>Admin - <span class="method">admin.py</span></a><br>
	    <p>Create Admin user: </p>
<pre class="prettyprint lang-bsh ">
# ~/mysite/ 
python manage.py createsuperuser
</pre>
<p>Import model and register admin site:</p>
<pre class="prettyprint lang-python ">
# ~/mysite/main/admin.py
from django.contrib import admin
from .models import Tutorial

class TutorialAdmin(admin.ModelAdmin):

    # option: select fields in admin site
    # fields = ["tutorial_title",
    #          "tutorial_published",
    #          "tutorial_content"
    #          ]
    
    # option: separate into sets in presentation          
    fieldsets = [
            ("Title/date", {"fields": ["tutorial_title", "tutorial_published"]}),
            ("Content", {"fields": ["tutorial_content"]})
            ]

admin.site.register(Tutorial)
</pre>	
<p></p>
    </li> 

<!----------------------------------- USER REGISTER --------------------------------------->
    <li class="coding-text">
	    <a>User registration</a><br>
<pre class="prettyprint lang-html ">
&lt;!-- ~/mysite/main/templates/main/register.html   -->
{% extends "main/header.html" %}

{% block content %}

    &lt;form method="POST">
        {% csrf_token %}
        {{form.as_p}}
        &lt;br>
        &lt;button class="btn" type="submit">Register&lt;/button>
    &lt;/form>

    If you already have an account. &lt;a href="/login">login&lt;/a> instead.
{% endblock %}
</pre>   
<pre class="prettyprint lang-python">
# ~/mysite/main/urls.py
urlpatterns = [
    ...,
    path("register/", views.register, name="register")
]    

# ~/mysite/main/views.py
from django.shortcuts import render, redirect
from django.contrib.auth.forms import UserCreationForm
from django.contrib.auth import login, logout, authenticate

def register(request):
    if request.method == "POST":
        form = UserCreationForm(request.POST)
        if form.is_valid():
            user = form.save()
            username = form.cleaned_data.get('username')
            login(request, user)
            return redirect("main:homepage")  #preferred way, dynamic indept of url changes
        else:
            for msg in form.error_messages:
                print(form.error_messages[msg])

    form = UserCreationForm 
    return render(request=request,
                template_name="main/register.html",
                context={"form": form})
</pre>
    </li>
<!----------------------------------- USER LOGIN/LOGOUT --------------------------------------->
    <li class="coding-text">
	    <a>User login/logout</a><br>
	</li>
	
<!----------------------------------- SETTINGS --------------------------------------->
    <li class="coding-text">
	    <a>Project Settings - <span class="method">settings.py</span></a>
        <p>It sets up everything for the project: key, apps, database, packages, and more...</p>
<pre class="prettyprint lang-python ">
# ~/mysite/settings.py

ALLOWED_HOSTS = [
    '10.0.0.5'
]

INSTALLED_APPS = [
    ...,
    'main.apps.MainConfig'
]

</pre>
    </li> 
    <li class="coding-text">
        <a>Additional resources</a>
        <p>&emsp; Awesome Text-Editor: <span style="font-family: 'Monaco', 'Menlo', 'Ubuntu Mono','Consolas','source-code-pro'">pip install django-tinymce4-lite</style></p>
    </li>

</ul>
<div class="footer">
    <a title="Back to Previous" href="https://wyqian1027.github.io/public/apps.html"><i class="fas fa-igloo"></i></a>
	<em>Last updated on April 24, 2019 by Wenyang Qian.</em>
</div>


<script>
    var myLi = document.querySelectorAll(".coding-text");
    //hide all but first
    myLi.forEach(function(el, j){
        if (j != 0){
            for (var i=1; i<el.children.length; i++){
                el.children[i].classList.toggle('show');
            }
            el.classList.toggle('change-li-before');
        }
    });
    myLi.forEach(function(el){
        el.children[0].addEventListener('click', function(){
            for (var i=1; i<el.children.length; i++){
                el.children[i].classList.toggle('show');
            }
            el.classList.toggle('change-li-before');
        });
    });
</script>
</body>
</html>